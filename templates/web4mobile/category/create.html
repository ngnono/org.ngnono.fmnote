{% extends "web4mobile/base.html" %}


{% block content %}
    <form method="POST" action="{% url 'apps.category.views.create' %}">
        {{ csrf_token }}
        {% if form.errors %}
            {{ form.errors }}
        {% endif %}
        <ul data-role="listview" data-inset="true">

            <li data-role="fieldcontain">

                <label for="txtName">名称</label>
                <input type="text" name="name" id="txtName"/>
            </li>

            <li data-role="fieldcontain">

                <label for="txtDescription">说明</label>
                <textarea cols="40" rows="8" name="description" id="txtDescription"></textarea>
            </li>

            <li data-role="fieldcontain">

                <label for="txtType">类型</label>
                <textarea cols="40" rows="8" name="type" id="txtType"></textarea>
            </li>

        </ul>
        <ul data-role="listview" data-inset="true">
            <li data-role="list-divider">父类</li>

            <li>
                <a href="#nav-category-panel" data-icon="bars" id="aPrentId">--</a>
            </li>

        </ul>

        <ul data-role="listview" data-inset="true">
            <li class="ui-body ui-bar-b">
                <fieldset class="ui-grid-a">
                    <div class="ui-block-b">
                        <button type="submit">保存</button>
                    </div>
                </fieldset>
            </li>
        </ul>
        <input type="hidden" id="hidPrentId" name="prentid"/>
    </form>
{% endblock %}

{% block customHomeArea %}
    <div data-role="panel" id="nav-category-panel" data-position-fixed="true" data-position="right">
        <ul data-role="listview" data-inset="true">
            <li><a href="#">编辑</a></li>
        </ul>
        <ul data-role="listview" data-inset="true" data-filter="true" data-filter-reveal="true"
            data-filter-placeholder="分类" id="ul-category-list">
        </ul>
    </div>


{% endblock %}


{% block footerJs %}

    <script type="text/javascript">

        function pageInit() {

            $('#ul-category-list').on('listviewbeforefilter', function (e, data) {
                var $ul = $(this), $input = $(data.input), value = $input.val(), html = '';

                $ul.html('');
                if (value && value.length > 1) {
                    $ul.html("<li><div class='ui-loader'><span class='ui-icon ui-icon-loading'></span></div></li>");
                    $ul.listview("refresh");
                    $.ajax({
                        url: "{% url 'apps.category.views.getlist'  %}",
                        dataType: "json",
                        type: "GET",
                        data: {
                            q: $input.val()
                        },
                        success: function (response) {
                            $.each(response, function (i, val) {
                                html += '<li><a href="javascript:void(0)" onclick="bindPrentId(' + val.Id + ',$(this).html())" title="' + val.Description + '">' + val.Name + '</a></li>';
                            });
                            $ul.html(html);
                            $ul.listview("refresh");
                            $ul.trigger("updatelayout");
                        },
                        error: function (response) {

                        }
                    });

                }
            });
        }

        function bindPrentId(id, name) {
            $('#hidPrentId').html(id);
            $('#aPrentId').html(name);
        }

        $('#home').bind('pageinit', pageInit);


    </script>
{% endblock %}